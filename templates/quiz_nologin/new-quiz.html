{% extends 'base/base.html' %}
{% load static %}
{% block title %}Question{% endblock title %}
{% block main-content %}


<div class="quiz-container container py-4">
    <!-- Progress Bar -->
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Question {{ current_question_number }} of {{ total_questions }}</span>
            <span class="fw-semibold">{{ question.session.title }}</span>
        </div>
        <div class="progress" style="height: 10px;">
            <div class="progress-bar bg-success" role="progressbar" 
                 style="width: calc(({{ current_question_number }} / {{ total_questions|default:1 }}) * 100%);"
                 aria-valuenow="{{ current_question_number }}" 
                 aria-valuemin="1" 
                 aria-valuemax="{{ total_questions }}">
            </div>
        </div>
    </div>

    <div class="card question-card shadow-sm border-0">
        <div class="card-header bg-light">
            <h4 class="card-title mb-0">Question {{ current_question_number }}</h4>
        </div>
        <div class="card-body">
            <form method="post" id="questionForm">
                {% csrf_token %}
                
                <h5 class="mb-4">{{ question.text }}</h5>
                
                <div class="options-container">
                    {% for option in options %}
                        <div class="card option-card mb-2 border-0 shadow-sm {% if user_answer and user_answer.selected_option == option.letter %}selected{% endif %}"
                             onclick="selectOption('{{ option.letter }}')">
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" 
                                           name="selected_option" 
                                           id="option{{ option.letter }}" 
                                           value="{{ option.letter }}"
                                           {% if user_answer and user_answer.selected_option == option.letter %}checked{% endif %}>
                                    <label class="form-check-label w-100" for="option{{ option.letter }}">
                                        <strong>{{ option.letter }})</strong> {{ option.text }}
                                    </label>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Navigation Buttons: only Save & Next or Finish Quiz -->
                <div class="d-flex justify-content-end mt-4">
                    {% if next_question %}
                        <button type="submit" class="btn btn-primary">Save & Next â†’</button>
                    {% else %}
                        <button type="submit" class="btn btn-success">Finish Quiz</button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <!-- Quiz Info -->
    <div class="mt-3 text-center">
        <small class="text-muted">
            Your progress is automatically saved. You can navigate between questions using Previous/Next buttons.
        </small>
    </div>
</div>

<script>
function selectOption(letter) {
    // Uncheck all radio buttons
    document.querySelectorAll('input[name="selected_option"]').forEach(radio => {
        radio.checked = false;
    });
    
    // Check the selected radio button
    document.getElementById('option' + letter).checked = true;
    
    // Update visual selection
    document.querySelectorAll('.option-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.querySelectorAll('.option-card').forEach(card => {
        if (card.querySelector('input').value === letter) {
            card.classList.add('selected');
        }
    });
}

// Initialize selection on page load
document.addEventListener('DOMContentLoaded', function() {
    const checkedRadio = document.querySelector('input[name="selected_option"]:checked');
    if (checkedRadio) {
        selectOption(checkedRadio.value);
    }
});

// Keyboard navigation
document.addEventListener('keydown', function(event) {
    if (event.key >= '1' && event.key <= '4') {
        const letters = ['A', 'B', 'C', 'D'];
        selectOption(letters[parseInt(event.key) - 1]);
    } else if (event.key === 'Enter') {
        document.getElementById('questionForm').submit();
    }
});
</script>

<style>
    .option-card { transition: transform .08s ease, box-shadow .2s ease; border-radius: 12px; }
    .option-card:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.06) !important; cursor: pointer; }
    .option-card.selected { outline: 2px solid #0d6efd; }
</style>

{% endblock main-content %}